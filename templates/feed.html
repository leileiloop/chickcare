<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Feeding Schedule | Chick Care</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .circle-wrap, .circle-wrap-1 {
            width: 120px;
            height: 120px;
            position: relative;
            margin: auto;
        }
        .inside-circle, .inside-circle-1 {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            line-height: 80px;
            font-weight: bold;
        }
        .stop-container1 {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }
        .stop-btn1 {
            padding: 10px 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            background-color: #f44336;
            color: #fff;
            border: none;
        }
        .meal-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .meal-table th, .meal-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container">

    <!-- Sidebar Navigation -->
    <div class="navigation">
        <ul>
            <li>
                <a href="#"><span class="icon"><img src="{{ url_for('static', filename='imgs/CC.png') }}"></span><span class="title1">Chick Care</span></a>
            </li>
            <li><a href="/main_dashboard"><span class="icon"><ion-icon name="reorder-four-outline"></ion-icon></span><span class="title">Dashboard</span></a></li>
            <li><a href="/webcam"><span class="icon"><ion-icon name="stats-chart-outline"></ion-icon></span><span class="title">Growth Tracking</span></a></li>
            <li><a href="/feeding" class="active"><span class="icon"><ion-icon name="layers-outline"></ion-icon></span><span class="title">Supplies Stock</span></a></li>
            <li><a href="/environment"><span class="icon"><ion-icon name="cloudy-outline"></ion-icon></span><span class="title">Environment</span></a></li>
            <li><a href="/dashboard"><span class="icon"><ion-icon name="notifications-circle-outline"></ion-icon></span><span class="title">Notifications</span></a></li>
            <li><a href="/sanitization"><span class="icon"><ion-icon name="water-outline"></ion-icon></span><span class="title">Sanitization</span></a></li>
            {% if session['user_role'] == 'admin' %}
            <li><a href="/manage_users"><span class="icon"><ion-icon name="people-outline"></ion-icon></span><span class="title">Manage Users</span></a></li>
            {% endif %}
            <li><a href="/report"><span class="icon"><ion-icon name="file-tray-stacked-outline"></ion-icon></span><span class="title">Report</span></a></li>
            <li><a href="/login"><span class="icon"><ion-icon name="log-out-outline"></ion-icon></span><span class="title">Sign Out</span></a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main">
        <div class="topbar">
            <div class="toggle"><ion-icon name="menu-outline"></ion-icon></div>
            <div class="datetime"><span id="displayDateTime"></span></div>

            <div class="iconn" onclick="toggleNotifi()">
                <img src="{{ url_for('static', filename='imgs/bell.png') }}" alt="">
                <span id="notificationCount">0</span>
            </div>
            <div class="notifi-box" id="box">
                <h2>Notifications <span id="notificationCount1">0</span></h2>
                <div class="notifi-item">
                    <div class="text" id="notificationItems"></div>
                </div>
            </div>

            <div class="user">
                <img src="{{ url_for('static', filename='imgs/admin.jpg') }}" alt="">
            </div>
        </div>

        <!-- Feeding Schedule -->
        <div class="schedule">
            <h1>Supplies Stock</h1>

            <div class="cardBox">
                <!-- Water Gauge -->
                <div class="card">
                    <p class="head-1">Water</p>
                    <div class="circle-wrap">
                        <div class="circle">
                            <div class="mask full" id="water-fill"><div class="fill"></div></div>
                            <div class="mask half"><div class="fill"></div></div>
                            <div class="inside-circle" id="waterLevel">--%</div>
                        </div>
                    </div>
                    <button id="stopWaterRelay" class="stop-btn1">STOP</button>
                </div>

                <!-- Food Gauge -->
                <div class="card">
                    <p class="head-1">Food</p>
                    <div class="circle-wrap-1">
                        <div class="circle-1">
                            <div class="mask full-1"><div class="fill-1"></div></div>
                            <div class="mask half-1"><div class="fill-1"></div></div>
                            <div class="inside-circle-1" id="foodLevel">--%</div>
                        </div>
                    </div>
                    <button id="stopServoFood" class="stop-btn1">STOP</button>
                </div>
            </div>

            <!-- Table -->
            <div class="tableSched">
                <table class="meal-table">
                    <thead>
                        <tr>
                            <th>DateTime</th>
                            <th>Food</th>
                            <th>Water</th>
                        </tr>
                    </thead>
                    <tbody id="feedingRecords"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

<script>
    function toggleNotifi() {
        const box = document.getElementById('box');
        box.style.display = box.style.display === 'block' ? 'none' : 'block';
    }

    async function loadFeeding() {
        const res = await fetch('/api/feeding');
        const data = await res.json();

        // Update gauges
        document.getElementById('waterLevel').innerText = data.water + '%';
        document.getElementById('foodLevel').innerText = data.food + '%';

        // Update table
        const tbody = document.getElementById('feedingRecords');
        tbody.innerHTML = '';
        data.records.forEach(r => {
            tbody.innerHTML += `<tr>
                <td>${r.datetime}</td>
                <td>${r.food}</td>
                <td>${r.water}</td>
            </tr>`;
        });
    }

    loadFeeding();
    setInterval(loadFeeding, 10000); // Refresh every 10s
</script>

</body>
</html>
