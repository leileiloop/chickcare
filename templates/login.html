<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login & Reset Forms | Dan Aleko</title>
  <!-- Load Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Load Boxicons for icons -->
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* Custom styles for background and font application */
    body {
      /* Simulating a dark, blurred background */
      background: linear-gradient(135deg, #1f2937 0%, #0f172a 100%);
      font-family: 'Inter', sans-serif;
    }
    /* Specific styling for the input box for the icon positioning */
    .input-box-container {
        position: relative;
    }
    .input-icon {
        position: absolute;
        right: 1.25rem; /* 20px */
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.25rem; /* 20px */
        color: rgba(255, 255, 255, 0.8);
    }
    /* Input placeholder color fix for transparent background */
    .form-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }
    /* ADDED STYLES FOR FLASK FLASH MESSAGES */
    .flash-success {
        background-color: #10b981; /* emerald-500 */
    }
    .flash-danger {
        background-color: #ef4444; /* red-500 */
    }
    .flash-warning {
        background-color: #f59e0b; /* amber-500 */
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

  <!-- Main Wrapper -->
  <div class="w-full max-w-sm p-8 md:p-10 bg-white/5 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl text-white transform hover:shadow-3xl transition duration-500">

    <!-- LOGIN FORM (Default View) -->
    <div id="loginForm" class="form-container">
      <h1 class="text-3xl font-extrabold text-center mb-8">Login</h1>

      <!-- START: Flask Flash Message Logic -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <!-- Note: category is like 'success', 'danger', 'warning' -->
                <div class="p-3 mb-4 rounded-lg text-sm font-medium {{ 'flash-' + category }} text-white">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
      {% endwith %}
      <!-- END: Flask Flash Message Logic -->

      <form method="post" action="{{ url_for('login') }}">
        <!-- Username Input -->
        <div class="input-box-container mb-6">
          <input
            type="text"
            name="username"
            placeholder="Username"
            required
            class="form-input w-full h-14 px-5 bg-white/10 border border-white/30 rounded-full text-white focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent transition duration-300 placeholder-white/80"
          >
          <i class='bx bxs-user input-icon'></i>
        </div>

        <!-- Password Input -->
        <div class="input-box-container mb-6">
          <input
            type="password"
            name="password"
            placeholder="Password"
            required
            class="form-input w-full h-14 px-5 bg-white/10 border border-white/30 rounded-full text-white focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent transition duration-300 placeholder-white/80"
          >
          <i class='bx bxs-lock-alt input-icon'></i>
        </div>

        <!-- Remember Me & Forgot Password -->
        <div class="flex justify-between items-center text-sm mb-6">
          <label class="flex items-center cursor-pointer">
            <input type="checkbox" name="remember" class="mr-2 accent-white w-4 h-4 rounded">
            Remember me
          </label>
          <a href="#" id="showForgotPassword" class="text-white/80 hover:underline hover:text-white transition duration-200">
            Forgot Password?
          </a>
        </div>

        <!-- Login Button -->
        <button
          type="submit"
          class="w-full h-12 bg-white text-gray-900 font-bold rounded-full text-lg shadow-xl hover:bg-gray-200 transition duration-300"
        >
          Login
        </button>

        <!-- Register Link -->
        <div class="text-center text-sm mt-6">
          <p>Don't have an account?
            <a href="{{ url_for('register') }}" class="text-yellow-300 font-semibold hover:underline transition duration-200">
              Register
            </a>
          </p>
        </div>
      </form>
    </div>

    <!-- FORGOT PASSWORD FORM (Hidden by Default) -->
    <div id="forgotPasswordForm" class="form-container hidden">
      <h1 class="text-3xl font-extrabold text-center mb-4">Reset Password</h1>
      <p class="text-center text-sm mb-8 text-white/80">
          Enter your email to receive a password reset link.
      </p>

      <!-- START: Flask Flash Message Logic for Forgot Password -->
      <!-- We re-display the flash messages here in case Flask redirects back to the forgot_password route -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="p-3 mb-4 rounded-lg text-sm font-medium {{ 'flash-' + category }} text-white">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
      {% endwith %}
      <!-- END: Flask Flash Message Logic -->

      <form method="post" action="{{ url_for('forgot_password') }}">
        <!-- Email Input -->
        <div class="input-box-container mb-6">
          <input
            type="email"
            name="email"
            placeholder="Email Address"
            required
            class="form-input w-full h-14 px-5 bg-white/10 border border-white/30 rounded-full text-white focus:outline-none focus:ring-2 focus:ring-white focus:border-transparent transition duration-300 placeholder-white/80"
          >
          <i class='bx bxs-envelope input-icon'></i>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full h-12 bg-yellow-300 text-gray-900 font-bold rounded-full text-lg shadow-xl hover:bg-yellow-400 transition duration-300"
        >
          Send Reset Link
        </button>

        <!-- Back to Login/Register Links -->
        <div class="text-center text-sm mt-6 space-y-2">
          <p>Remembered your password?
            <!-- This is the JavaScript client-side switch -->
            <a href="#" id="showLoginFromForgot" class="text-yellow-300 font-semibold hover:underline transition duration-200">
              Back to Login
            </a>
          </p>
          <p>Need an account?
            <a href="{{ url_for('register') }}" class="text-white/80 font-semibold hover:underline transition duration-200">
              Register
            </a>
          </p>
        </div>
      </form>
    </div>

  </div>

  <script>
    // === Form Toggling Logic ===
    const loginForm = document.getElementById('loginForm');
    const forgotPasswordForm = document.getElementById('forgotPasswordForm');
    const showForgotPasswordLink = document.getElementById('showForgotPassword');
    const showLoginFromForgotLink = document.getElementById('showLoginFromForgot');

    /**
     * Toggles the visibility between the login and forgot password forms.
     * @param {string} formToShow - 'login' or 'forgot'
     */
    function showForm(formToShow) {
        if (formToShow === 'forgot') {
            loginForm.classList.add('hidden');
            forgotPasswordForm.classList.remove('hidden');
        } else {
            loginForm.classList.remove('hidden');
            forgotPasswordForm.classList.add('hidden');
        }
    }

    // Event listeners to switch forms
    showForgotPasswordLink.addEventListener('click', (e) => {
        e.preventDefault();
        showForm('forgot');
    });

    showLoginFromForgotLink.addEventListener('click', (e) => {
        e.preventDefault();
        showForm('login');
    });

    // Determine which form to show on page load based on the route or flash messages
    window.onload = function() {
        const urlPath = window.location.pathname;
        if (urlPath.includes('forgot_password')) {
            // If the user was redirected to forgot_password (e.g., if submission failed)
            showForm('forgot');
        }
    };

  </script>
</body>
</html>
